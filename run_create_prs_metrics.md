# Calculate PRS accuracy metrics

<br>

## 1. Prerequisites

### 1.1 Software
- R >= 3.6
- R packages
  - install.packages("data.table")
  - install.packages("pROC")
  - install.packages("boot")
  - install.packages("optparse")
- Download analysis scripts

### 1.2 Input Files

- Score file (`prsfile`)
  - suffix with *.profile or .sscore* generated by plink 1.* or plink 2.0
- Phenotype file (`phenofile`)
  - Columns include FID, IID and phenotype (from 14 endpoints)
- Sampel IDs (`popfile`)
  - List **unrelated individuals** in the target ancestry with FID IID included in the first two columns.
- Covariate file (`covfile`)
  - Columns include FID, IID, your **Biobank specific** covariates used in your GWAS analyses
- PC file (`pcfile`)
  - Columns include FID, IID, PC1, PC2...


<br>

## 2. Set variables
Before running please edit *run_create_prs_metrics.sh* with your biobank-specific parameters. Specifically:

- `pop`: Target ancestry, labelled as **NFE FIN AMR CSA MID EAS AFR** used in GBMI analyses.
- `pheno`: Phenotype name in the phenotype file, including the 14 endpoints:**AAA AcApp Asthma Appendectomy COPD Gout HCM HF IPF POAG Stroke ThC UtC VTE**.
- `K`: Disease prevalence, default is **NULL** and the script will use the proportion of cases in the target population instead.
- `covs`: Covariates included in the prediction model, separated by comma, e.g., "Age,Sex". **Note the covariates here are separated from PCs , using the same covariates included in GWAS analyses is recommended**. 
- `pc_numbers`: PCs included in the prediction model, separated by comma. The default is 10 PCs: "PC1,PC2,PC3,PC4,PC5,PC6,PC7,PC8,PC9,PC10". **Note use the same covariates included in GWAS analyses is recommended**.
- `phenofile`: Full path and file name to the phenotype file (headers including FID, IID, phenotypes etc.)
- `popfile`: Full path and file name to the file listing IDs for **unrelated individuals** in the target population (in the format of FID, IID as the first two columns)
- `prsfile`: Full path and file name to a *.profile generated by Plink1.* or *.sscore by Plink2.*, note using \--sum to get the SCORESUM for Plink 1.* or cols=+scoresums to get SCORE1_SUM for Plink 2.* used in this script
- `covfile`: Full path and file name to the file including covariates (with headers including FID, IID and covariates)
- `pcfile`: Full path and file name to the file including PCs (e.g., headers including FID, IID, PC1, PC2, PC3...)
- `cohort_name`: Your specific Biobanks name, e.g., "UKBB"
- `ldref`: The LD reference panel used (e.g., 1KG or UKB)
- `out`: Full path and file name for the output file of the prs accuracy metrics

<br>

## 3. Run the script

After setting the variables, please run the script.

- `bash run_create_prs_metrics.sh`

<br>

This will generate a output file including the below information:

- `cohort` - specific Biobank name
- `ldref` - LD reference panel
- `prefix` - prefix for the file name of PRS score 
- `N` - total sample size with non-NA phenotypes
- `K` - base population risk of disease/disease prevalence used for calculating variance explained in liability scale
- `P` - proportion of sample that are cases
- `NKr2 (NKr2_2.5, NKr2_97.5)` - Nagelkerke's R2 (& its 95% CIs)
- `NKr2_pval` - p value of the NKr2
- `h2l_NKr2 &(h2l_NKr2_2.5, h2l_NKr2_97.5)` - proportion of variance explained by the score on the liability scale (& its 95% CIs)
- `auc1 (acu1_2.5, auc1_97.5)` - AUC using full model (& its 95% CIs)
- `auc2 (acu2_2.5, auc2_97.5)` - AUC using PRS only (& its 95% CIs)

<br>












